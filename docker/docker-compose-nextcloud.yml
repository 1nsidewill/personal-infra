# Nextcloud All-in-One (AIO) ì»¨í…Œì´ë„ˆ
# ì°¸ì¡°: https://github.com/techworks-id/nextcloud_aio-traefik

services:
  nextcloud-aio-mastercontainer:
    image: nextcloud/all-in-one:latest
    init: true
    restart: unless-stopped
    container_name: nextcloud-aio-mastercontainer
    
    volumes:
      # AIO ì„¤ì • ë³¼ë¥¨ (ì´ë¦„ ë³€ê²½ ê¸ˆì§€)
      - nextcloud_aio_mastercontainer:/mnt/docker-aio-config
      # Docker ì†Œì¼“ (macOS/Windowsì—ì„œëŠ” ê²½ë¡œ ì¡°ì • í•„ìš”)
      - /var/run/docker.sock:/var/run/docker.sock:ro
      
    # ê¸°ë³¸ bridge ë„¤íŠ¸ì›Œí¬ ì‚¬ìš© (ì°¸ì¡° ë¦¬í¬ì™€ ë™ì¼)
    network_mode: bridge
    
    ports:
      # HTTP/HTTPSëŠ” Traefikì´ ì²˜ë¦¬í•˜ë¯€ë¡œ ë¹„í™œì„±í™”
      # - 80:80    # Traefikì´ ì²˜ë¦¬
      # - 8443:8443  # Traefikì´ ì²˜ë¦¬
      - "${AIO_ADMIN_PORT:-8081}:8080"  # AIO ê´€ë¦¬ íŒ¨ë„
      
    environment:
      # ==========================================
      # ğŸŒ Apache ì›¹ì„œë²„ ì„¤ì • (í•„ìˆ˜)
      # ==========================================
      - APACHE_PORT=${APACHE_PORT:-11000}
      - APACHE_IP_BINDING=${APACHE_IP_BINDING:-127.0.0.1}
      
      # ==========================================
      # ğŸ“ ë°ì´í„° ë””ë ‰í† ë¦¬ ì„¤ì •
      # ==========================================
      - NEXTCLOUD_DATADIR=${NEXTCLOUD_DATADIR:-/mnt/ncdata}
      
      # ==========================================
      # ğŸš€ ì„±ëŠ¥ & ì œí•œ ì„¤ì • (ê¸°ë³¸ê°’ ì‚¬ìš©)
      # ==========================================
      - NEXTCLOUD_UPLOAD_LIMIT=${NEXTCLOUD_UPLOAD_LIMIT:-10G}
      - NEXTCLOUD_MAX_TIME=${NEXTCLOUD_MAX_TIME:-3600}
      - NEXTCLOUD_MEMORY_LIMIT=${NEXTCLOUD_MEMORY_LIMIT:-512M}
      
      # ==========================================
      # ğŸ”§ ì¶”ê°€ íŒ¨í‚¤ì§€ & PHP í™•ì¥
      # ==========================================
      - NEXTCLOUD_ADDITIONAL_APKS=${NEXTCLOUD_ADDITIONAL_APKS:-imagemagick}
      - NEXTCLOUD_ADDITIONAL_PHP_EXTENSIONS=${NEXTCLOUD_ADDITIONAL_PHP_EXTENSIONS:-imagick}
      
    # SELinux ì‚¬ìš© ì‹œ í•„ìš”
    # security_opt: ["label:disable"]

volumes:
  # AIO ë§ˆìŠ¤í„° ì»¨í…Œì´ë„ˆ ë³¼ë¥¨ (ì´ë¦„ ë³€ê²½ ê¸ˆì§€)
  nextcloud_aio_mastercontainer:
    name: nextcloud_aio_mastercontainer 