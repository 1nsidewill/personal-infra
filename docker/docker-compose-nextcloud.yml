# Nextcloud All-in-One (AIO) ì»¨í…Œì´ë„ˆ
# ì°¸ì¡°: https://github.com/techworks-id/nextcloud_aio-traefik

services:
  nextcloud-aio-mastercontainer:
    image: nextcloud/all-in-one:latest
    init: true
    restart: unless-stopped
    container_name: nextcloud-aio-mastercontainer
    
    volumes:
      # AIO ì„¤ì • ë³¼ë¥¨ (ì´ë¦„ ë³€ê²½ ê¸ˆì§€)
      - nextcloud_aio_mastercontainer:/mnt/docker-aio-config
      # Docker ì†Œì¼“ (macOS/Windowsì—ì„œëŠ” ê²½ë¡œ ì¡°ì • í•„ìš”)
      - /var/run/docker.sock:/var/run/docker.sock:ro
      
    # ê¸°ë³¸ bridge ë„¤íŠ¸ì›Œí¬ ì‚¬ìš© (docker runê³¼ ë™ì¼)
    network_mode: bridge
    
    ports:
      # HTTP/HTTPSëŠ” Traefikì´ ì²˜ë¦¬í•˜ë¯€ë¡œ ë¹„í™œì„±í™”
      # - 80:80    # Traefikì´ ì²˜ë¦¬
      # - 8443:8443  # Traefikì´ ì²˜ë¦¬
      - "${AIO_ADMIN_PORT}:8080"  # AIO ê´€ë¦¬ íŒ¨ë„
      
    environment:
      # ==========================================
      # ğŸ•’ ì‹œê°„ëŒ€ ì„¤ì •
      # ==========================================
      - TZ=${TZ}
      
      # ==========================================
      # ğŸŒ Apache ì›¹ì„œë²„ ì„¤ì •
      # ==========================================
      - APACHE_PORT=${APACHE_PORT}
      - APACHE_IP_BINDING=${APACHE_IP_BINDING}
      
      # ==========================================
      # ğŸ“ ë°ì´í„° ë””ë ‰í† ë¦¬ ì„¤ì •
      # ==========================================
      - NEXTCLOUD_DATADIR=${NEXTCLOUD_DATADIR}
      
      # ==========================================
      # ğŸš€ ì„±ëŠ¥ & ì œí•œ ì„¤ì •
      # ==========================================
      - NEXTCLOUD_UPLOAD_LIMIT=${NEXTCLOUD_UPLOAD_LIMIT}
      - NEXTCLOUD_MAX_TIME=${NEXTCLOUD_MAX_TIME}
      - NEXTCLOUD_MEMORY_LIMIT=${NEXTCLOUD_MEMORY_LIMIT}
      
      # ==========================================
      # ğŸ”§ ì¶”ê°€ íŒ¨í‚¤ì§€ & PHP í™•ì¥
      # ==========================================
      - NEXTCLOUD_ADDITIONAL_APKS=${NEXTCLOUD_ADDITIONAL_APKS}
      - NEXTCLOUD_ADDITIONAL_PHP_EXTENSIONS=${NEXTCLOUD_ADDITIONAL_PHP_EXTENSIONS}
      
      # ==========================================
      # ğŸ”’ ë³´ì•ˆ & ì‹ ë¢° ë„ë©”ì¸ ì„¤ì •
      # ==========================================
      - NEXTCLOUD_TRUSTED_DOMAINS=${NEXTCLOUD_DOMAIN}
      
      # ==========================================
      # ğŸ›ï¸ ì„ íƒì  ê¸°ëŠ¥ë“¤ (ì£¼ì„ í•´ì œí•˜ì—¬ ì‚¬ìš©)
      # ==========================================
      # - AIO_DISABLE_BACKUP_SECTION=false
      # - BORG_RETENTION_POLICY=--keep-within=7d --keep-weekly=4 --keep-monthly=6
      # - COLLABORA_SECCOMP_DISABLED=false
      # - NEXTCLOUD_MOUNT=/mnt/
      # - NEXTCLOUD_TRUSTED_CACERTS_DIR=/path/to/my/cacerts
      # - NEXTCLOUD_STARTUP_APPS=deck twofactor_totp tasks calendar contacts notes
      # - NEXTCLOUD_ENABLE_DRI_DEVICE=true
      # - NEXTCLOUD_KEEP_DISABLED_APPS=false
      # - TALK_PORT=3478
      # - WATCHTOWER_DOCKER_SOCKET_PATH=/var/run/docker.sock
      
    # SELinux ì‚¬ìš© ì‹œ í•„ìš”
    # security_opt: ["label:disable"]

volumes:
  # AIO ë§ˆìŠ¤í„° ì»¨í…Œì´ë„ˆ ë³¼ë¥¨ (ì´ë¦„ ë³€ê²½ ê¸ˆì§€)
  nextcloud_aio_mastercontainer:
    name: nextcloud_aio_mastercontainer 